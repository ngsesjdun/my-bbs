const _0x2b1e11=_0x444e;(function(_0x1802df,_0x39c032){const _0x2c80df=_0x444e,_0x469037=_0x1802df();while(!![]){try{const _0x14762b=-parseInt(_0x2c80df(0x213))/0x1+parseInt(_0x2c80df(0x1ec))/0x2*(-parseInt(_0x2c80df(0x202))/0x3)+parseInt(_0x2c80df(0x1e1))/0x4+-parseInt(_0x2c80df(0x1d0))/0x5*(parseInt(_0x2c80df(0x1d4))/0x6)+-parseInt(_0x2c80df(0x1fc))/0x7*(parseInt(_0x2c80df(0x1f7))/0x8)+parseInt(_0x2c80df(0x216))/0x9+-parseInt(_0x2c80df(0x22f))/0xa*(-parseInt(_0x2c80df(0x235))/0xb);if(_0x14762b===_0x39c032)break;else _0x469037['push'](_0x469037['shift']());}catch(_0xb2b155){_0x469037['push'](_0x469037['shift']());}}}(_0x9a60,0xe972c));import{createClient}from'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';const SUPABASE_URL='https://hwjdqrbeahuxkigoudfy.supabase.co',MOZI=_0x2b1e11(0x23f),db=createClient(SUPABASE_URL,MOZI);function escapeHTML(_0xe18a1d){const _0x2ea217=_0x2b1e11;return _0xe18a1d[_0x2ea217(0x214)](/[&<>"']/g,_0x2a9d46=>({'&':_0x2ea217(0x220),'<':_0x2ea217(0x21e),'>':_0x2ea217(0x1f8),'\x22':_0x2ea217(0x1e9),'\x27':_0x2ea217(0x22e)}[_0x2a9d46]));}function parseDecorations(_0x16c15a){const _0xc812b5=_0x2b1e11;return _0x16c15a=_0x16c15a[_0xc812b5(0x214)](/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(_0x1f8de2,_0x5d4432,_0x4b977c)=>_0xc812b5(0x223)+_0x4b977c+_0xc812b5(0x22a)+escapeHTML(_0x5d4432)+_0xc812b5(0x233)),_0x16c15a=_0x16c15a['replace'](/(https?:\/\/[^\s<>"']+)/g,_0xaa165=>_0xc812b5(0x223)+_0xaa165+_0xc812b5(0x22a)+escapeHTML(_0xaa165)+_0xc812b5(0x233)),_0x16c15a;}function _0x9a60(){const _0x48be9f=['apply','getFullYear','\x22\x20target=\x22_blank\x22\x20rel=\x22noopener\x20noreferrer\x22>','block','getMonth','href','&#39;','4550taVyuz','back-top','split','post-name','</a>','本文は200文字までです','110550cHrIFJ','fromCharCode','subscribe','includes','back','4px','getElementById','title','\x20ID:','match','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3amRxcmJlYWh1eGtpZ291ZGZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDkwMjYsImV4cCI6MjA3MTE4NTAyNn0.-5h-SQ5Vns7cNBZTaVTw14xGf-00IHnhjXTluZiUU-U','?thread=','getHours','SHA-256','color','addEventListener','refresh-threads','has','3444750vjkgiL','createElement','channel','select','6gxmiom','bbsUserIdDate','連投は2秒空けてください','created_at','名無し','refresh-posts','span','className','none','now','digest','error','id,title','2111240MYyyMN','<br>','toISOString','スレ作成失敗','green','length','本文を入れて','threads','&quot;','thread-view','setItem','96MSUMMF','slice','posts','thread-title','from','https://ngsesjdun.github.io/my-bbs','----','thread-name-input','padStart','thread-first','marginLeft','2933136ZurcHm','&gt;','thread_id','location','margin','35ZhUnnK','new','click','value','style','public:posts','64713KzZvru','初回本文投稿失敗','createTextNode','replaceState','thread-body-input','innerHTML','send','1px\x20solid\x20#000','bbsUserId','random','content','limit','getMinutes','投稿失敗','textContent','subtle','charAt','1887902mwHlVi','replace','div','11710026doyokK','thread','order','thread-title-input','floor','create-thread','maybeSingle','getSeconds','&lt;','display','&amp;','encode','ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789','<a\x20href=\x22','insert','trim','appendChild','タイトルを入れて'];_0x9a60=function(){return _0x48be9f;};return _0x9a60();}function generateDailyId(){const _0x86986b=_0x2b1e11,_0x19ffe0=new Date()[_0x86986b(0x1e3)]()[_0x86986b(0x1ed)](0x0,0xa),_0x31120c=localStorage['getItem'](_0x86986b(0x20a)),_0x4ed556=localStorage['getItem'](_0x86986b(0x1d5));if(_0x31120c&&_0x4ed556===_0x19ffe0)return _0x31120c;const _0x4ce8b2=_0x86986b(0x222);let _0x3527b5='';for(let _0x5730c4=0x0;_0x5730c4<0x4;_0x5730c4++)_0x3527b5+=_0x4ce8b2[_0x86986b(0x212)](Math[_0x86986b(0x21a)](Math[_0x86986b(0x20b)]()*_0x4ce8b2['length']));return localStorage[_0x86986b(0x1eb)]('bbsUserId',_0x3527b5),localStorage[_0x86986b(0x1eb)](_0x86986b(0x1d5),_0x19ffe0),_0x3527b5;}async function generateTripKey(_0x19b61b){const _0x5290f9=_0x2b1e11,_0x4fa43b=new TextEncoder()[_0x5290f9(0x221)](_0x19b61b),_0x2d8ac=await crypto[_0x5290f9(0x211)][_0x5290f9(0x1de)](_0x5290f9(0x242),_0x4fa43b),_0x288673=Array[_0x5290f9(0x1f0)](new Uint8Array(_0x2d8ac)),_0x39468b=btoa(String[_0x5290f9(0x236)][_0x5290f9(0x228)](null,_0x288673));return _0x39468b[_0x5290f9(0x214)](/[^A-Za-z0-9]/g,'')[_0x5290f9(0x1ed)](0x0,0xa);}const listView=document[_0x2b1e11(0x23b)]('list-view'),threadBox=document['getElementById']('thread-box'),postsEl=document[_0x2b1e11(0x23b)](_0x2b1e11(0x1ee)),viewWrap=document[_0x2b1e11(0x23b)](_0x2b1e11(0x1ea)),viewTitle=document[_0x2b1e11(0x23b)](_0x2b1e11(0x1ef)),newTitle=document['getElementById'](_0x2b1e11(0x219)),newBody=document[_0x2b1e11(0x23b)](_0x2b1e11(0x206)),newName=document[_0x2b1e11(0x23b)](_0x2b1e11(0x1f3)),btnCreate=document[_0x2b1e11(0x23b)](_0x2b1e11(0x21b)),inputMsg=document['getElementById']('post-message'),inputName=document['getElementById'](_0x2b1e11(0x232)),btnSend=document[_0x2b1e11(0x23b)](_0x2b1e11(0x208)),btnBack=document['getElementById'](_0x2b1e11(0x239)),btnBackTop=document[_0x2b1e11(0x23b)](_0x2b1e11(0x230)),btnRefreshThreads=document[_0x2b1e11(0x23b)](_0x2b1e11(0x245)),btnRefreshPosts=document[_0x2b1e11(0x23b)](_0x2b1e11(0x1d9));let currentThreadId=null,lastPostTime=0x0;function fmt(_0x161576){const _0x380150=_0x2b1e11;if(!_0x161576)return'';const _0x4d0495=_0x161576 instanceof Date?_0x161576:new Date(_0x161576);if(isNaN(_0x4d0495))return'';const _0x391262=['日','月','火','水','木','金','土'][_0x4d0495['getDay']()],_0x18b13f=(_0x5150fd,_0x3b3ae1=0x2)=>String(_0x5150fd)[_0x380150(0x1f4)](_0x3b3ae1,'0');return _0x4d0495[_0x380150(0x229)]()+'/'+_0x18b13f(_0x4d0495[_0x380150(0x22c)]()+0x1)+'/'+_0x18b13f(_0x4d0495['getDate']())+'('+_0x391262+')\x20'+_0x18b13f(_0x4d0495[_0x380150(0x241)]())+':'+_0x18b13f(_0x4d0495[_0x380150(0x20e)]())+':'+_0x18b13f(_0x4d0495[_0x380150(0x21d)]());}async function parseName(_0x4516bb){const _0x3456d9=_0x2b1e11;if(!_0x4516bb)return _0x3456d9(0x1d8);if(_0x4516bb[_0x3456d9(0x238)]('#')){const [_0x57c3c1,_0xedc5dd]=_0x4516bb[_0x3456d9(0x231)]('#'),_0x1d4f9a=await generateTripKey(_0xedc5dd);return _0x57c3c1+'◆'+_0x1d4f9a;}return _0x4516bb;}function _0x444e(_0x134f79,_0x503b6f){const _0x9a6084=_0x9a60();return _0x444e=function(_0x444e39,_0x579ec2){_0x444e39=_0x444e39-0x1cf;let _0x1ff110=_0x9a6084[_0x444e39];return _0x1ff110;},_0x444e(_0x134f79,_0x503b6f);}async function loadThreads(){const _0x7ec6e9=_0x2b1e11,{data:_0x1bc911,error:_0x4a4023}=await db[_0x7ec6e9(0x1f0)]('threads')['select']('id,title,created_at,posts(*)');if(_0x4a4023){console[_0x7ec6e9(0x1df)](_0x4a4023);return;}_0x1bc911['sort']((_0x29fb56,_0x4970fe)=>{const _0x141092=_0x7ec6e9,_0x1e47e9=_0x29fb56[_0x141092(0x1ee)][_0x141092(0x1e6)]>0x0?new Date(_0x29fb56[_0x141092(0x1ee)][_0x29fb56[_0x141092(0x1ee)][_0x141092(0x1e6)]-0x1]['created_at']):new Date(_0x29fb56[_0x141092(0x1d7)]),_0x157d48=_0x4970fe[_0x141092(0x1ee)]['length']>0x0?new Date(_0x4970fe['posts'][_0x4970fe[_0x141092(0x1ee)]['length']-0x1][_0x141092(0x1d7)]):new Date(_0x4970fe[_0x141092(0x1d7)]);return _0x157d48-_0x1e47e9;}),threadBox[_0x7ec6e9(0x207)]='';for(const _0x2fe5d6 of _0x1bc911){const _0x10de2c=document[_0x7ec6e9(0x1d1)]('div');_0x10de2c[_0x7ec6e9(0x200)]['border']=_0x7ec6e9(0x209),_0x10de2c[_0x7ec6e9(0x200)][_0x7ec6e9(0x1fb)]='2px\x200',_0x10de2c[_0x7ec6e9(0x200)]['padding']=_0x7ec6e9(0x23a);const _0x3dfb02=document[_0x7ec6e9(0x1d1)]('a');_0x3dfb02['href']='?thread='+_0x2fe5d6['id'],_0x3dfb02[_0x7ec6e9(0x207)]=escapeHTML(_0x2fe5d6[_0x7ec6e9(0x23c)])+'\x20('+_0x2fe5d6['posts'][_0x7ec6e9(0x1e6)]+')',_0x3dfb02['addEventListener'](_0x7ec6e9(0x1fe),_0x3eb198=>{const _0x245630=_0x7ec6e9;_0x3eb198['preventDefault'](),openThread(Number(_0x2fe5d6['id']),_0x2fe5d6[_0x245630(0x23c)]);}),_0x10de2c['appendChild'](_0x3dfb02);if(_0x2fe5d6['posts']&&_0x2fe5d6[_0x7ec6e9(0x1ee)][_0x7ec6e9(0x1e6)]>0x0){const _0x4b177c=_0x2fe5d6['posts']['sort']((_0x20bcc8,_0x4b4200)=>new Date(_0x20bcc8[_0x7ec6e9(0x1d7)])-new Date(_0x4b4200['created_at']))[0x0],_0x741cae=document['createElement'](_0x7ec6e9(0x215));_0x741cae[_0x7ec6e9(0x1db)]=_0x7ec6e9(0x1f5);let _0x6f3b7d=_0x4b177c[_0x7ec6e9(0x20c)][_0x7ec6e9(0x214)](/^\[[A-Z0-9]{4}\]\[[^\]]*\]\s*/,'');_0x6f3b7d=parseDecorations(_0x6f3b7d),_0x741cae[_0x7ec6e9(0x207)]=_0x6f3b7d,_0x10de2c['appendChild'](_0x741cae);}threadBox[_0x7ec6e9(0x226)](_0x10de2c);}listView['style'][_0x7ec6e9(0x21f)]=_0x7ec6e9(0x22b);}btnCreate[_0x2b1e11(0x244)]('click',async()=>{const _0x1dda09=_0x2b1e11,_0x23ec7d=newTitle[_0x1dda09(0x1ff)][_0x1dda09(0x225)](),_0x41b211=newBody['value'][_0x1dda09(0x225)](),_0x46661a=newName[_0x1dda09(0x1ff)][_0x1dda09(0x225)]();if(!_0x23ec7d){alert(_0x1dda09(0x227));return;}if(!_0x41b211){alert(_0x1dda09(0x1e7));return;}const _0x38904b=await parseName(_0x46661a),{data:_0x520fb1,error:_0x28a725}=await db['from'](_0x1dda09(0x1e8))[_0x1dda09(0x224)]([{'title':_0x23ec7d}])[_0x1dda09(0x1d3)]()[_0x1dda09(0x20d)](0x1)[_0x1dda09(0x21c)]();if(_0x28a725){console[_0x1dda09(0x1df)](_0x28a725),alert(_0x1dda09(0x1e4));return;}const _0x2c46df=Number(_0x520fb1['id']),_0x487fce=generateDailyId(),{error:_0x12a0a5}=await db[_0x1dda09(0x1f0)]('posts')[_0x1dda09(0x224)]([{'thread_id':_0x2c46df,'content':'['+_0x487fce+']['+_0x38904b+']\x20'+_0x41b211}]);if(_0x12a0a5){console[_0x1dda09(0x1df)](_0x12a0a5),alert(_0x1dda09(0x203));return;}newTitle[_0x1dda09(0x1ff)]='',newBody[_0x1dda09(0x1ff)]='',newName[_0x1dda09(0x1ff)]='',await loadThreads(),openThread(_0x2c46df,_0x23ec7d);});async function openThread(_0x4d996a,_0x202bc){const _0x3e2be6=_0x2b1e11;currentThreadId=_0x4d996a,viewTitle[_0x3e2be6(0x210)]=_0x202bc,history[_0x3e2be6(0x205)](null,null,_0x3e2be6(0x240)+_0x4d996a),listView[_0x3e2be6(0x200)][_0x3e2be6(0x21f)]=_0x3e2be6(0x1dc),viewWrap['style']['display']=_0x3e2be6(0x22b),await loadPosts();}async function loadPosts(){const _0x3c41c7=_0x2b1e11;if(!currentThreadId)return;const {data:_0x2af006,error:_0x4bca69}=await db[_0x3c41c7(0x1f0)](_0x3c41c7(0x1ee))['select']('*')['eq'](_0x3c41c7(0x1f9),currentThreadId)[_0x3c41c7(0x218)]('created_at',{'ascending':!![]});if(_0x4bca69){console[_0x3c41c7(0x1df)](_0x4bca69);return;}postsEl[_0x3c41c7(0x207)]='',(_0x2af006||[])['forEach']((_0x17e29a,_0x1894b5)=>{const _0x10dce3=_0x3c41c7,_0x2ea0a5=document[_0x10dce3(0x1d1)](_0x10dce3(0x215));_0x2ea0a5[_0x10dce3(0x1db)]='post';const _0x20fae1=_0x17e29a[_0x10dce3(0x20c)][_0x10dce3(0x23e)](/^\[[A-Z0-9]{4}\]\[([^\]]+)\]\s*/),_0x2b3be5=_0x20fae1?_0x20fae1[0x1]:'名無し',_0x48312e=_0x17e29a[_0x10dce3(0x20c)]['match'](/^\[([A-Z0-9]{4})\]/),_0xf716c0=_0x48312e?_0x48312e[0x1]:_0x10dce3(0x1f2),_0x79759d=_0x17e29a[_0x10dce3(0x20c)]['replace'](/^\[[A-Z0-9]{4}\]\[[^\]]*\]\s*/,''),_0x2b34a8=document[_0x10dce3(0x1d1)](_0x10dce3(0x215)),_0x319f5c=document[_0x10dce3(0x1d1)](_0x10dce3(0x1da));_0x319f5c[_0x10dce3(0x200)][_0x10dce3(0x243)]=_0x10dce3(0x1e5),_0x319f5c[_0x10dce3(0x210)]=_0x2b3be5,_0x2b34a8['appendChild'](document[_0x10dce3(0x204)]('['+(_0x1894b5+0x1)+']：')),_0x2b34a8[_0x10dce3(0x226)](_0x319f5c),_0x2b34a8[_0x10dce3(0x226)](document[_0x10dce3(0x204)]('：'+fmt(_0x17e29a['created_at'])+_0x10dce3(0x23d)+_0xf716c0));const _0x247e35=document[_0x10dce3(0x1d1)](_0x10dce3(0x215));_0x247e35[_0x10dce3(0x207)]=parseDecorations(_0x79759d)[_0x10dce3(0x214)](/\n/g,_0x10dce3(0x1e2)),_0x247e35[_0x10dce3(0x200)][_0x10dce3(0x1f6)]='1em',_0x2ea0a5['appendChild'](_0x2b34a8),_0x2ea0a5['appendChild'](_0x247e35),postsEl[_0x10dce3(0x226)](_0x2ea0a5);});}btnSend[_0x2b1e11(0x244)](_0x2b1e11(0x1fe),async()=>{const _0x442825=_0x2b1e11,_0x278099=Date[_0x442825(0x1dd)]();if(_0x278099-lastPostTime<0x7d0){alert(_0x442825(0x1d6));return;}if(!currentThreadId)return;let _0x3424e1=inputMsg[_0x442825(0x1ff)][_0x442825(0x225)]();if(!_0x3424e1)return;if(_0x3424e1['length']>0xc8){alert(_0x442825(0x234));return;}const _0x1be11e=inputName[_0x442825(0x1ff)][_0x442825(0x225)](),_0x5160bf=await parseName(_0x1be11e),_0xa0fb20=generateDailyId(),{error:_0x27e79f}=await db[_0x442825(0x1f0)](_0x442825(0x1ee))[_0x442825(0x224)]([{'thread_id':currentThreadId,'content':'['+_0xa0fb20+']['+_0x5160bf+']\x20'+_0x3424e1}]);if(_0x27e79f){console[_0x442825(0x1df)](_0x27e79f),alert(_0x442825(0x20f));return;}inputMsg['value']='',inputName['value']='',lastPostTime=_0x278099,await loadPosts();}),btnBack[_0x2b1e11(0x244)](_0x2b1e11(0x1fe),()=>{const _0x26c4b1=_0x2b1e11;window[_0x26c4b1(0x1fa)]['href']=_0x26c4b1(0x1f1);}),btnBackTop['addEventListener'](_0x2b1e11(0x1fe),()=>{const _0x51e6d4=_0x2b1e11;window['location'][_0x51e6d4(0x22d)]=_0x51e6d4(0x1f1);}),btnRefreshThreads[_0x2b1e11(0x244)](_0x2b1e11(0x1fe),async()=>{await loadThreads();}),btnRefreshPosts[_0x2b1e11(0x244)]('click',async()=>{if(currentThreadId)await loadPosts();}),db[_0x2b1e11(0x1d2)](_0x2b1e11(0x201))['on']('postgres_changes',{'event':'*','schema':'public','table':_0x2b1e11(0x1ee)},_0x931553=>{const _0xe64e2b=_0x2b1e11;if(currentThreadId&&_0x931553[_0xe64e2b(0x1fd)]['thread_id']===Number(currentThreadId))loadPosts();loadThreads();})[_0x2b1e11(0x237)](),loadThreads();const params=new URLSearchParams(location['search']);if(params[_0x2b1e11(0x1cf)]('thread')){const id=Number(params['get'](_0x2b1e11(0x217)));((async()=>{const _0x33e9bf=_0x2b1e11,{data:_0x2f65ac,error:_0x379c02}=await db[_0x33e9bf(0x1f0)](_0x33e9bf(0x1e8))[_0x33e9bf(0x1d3)](_0x33e9bf(0x1e0))['eq']('id',id)[_0x33e9bf(0x21c)]();if(_0x2f65ac)openThread(Number(_0x2f65ac['id']),_0x2f65ac[_0x33e9bf(0x23c)]);})());}
