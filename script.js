const _0xc36330=_0x79d9;(function(_0x3e0244,_0x1f1f6a){const _0x139996=_0x79d9,_0x471478=_0x3e0244();while(!![]){try{const _0x20d772=-parseInt(_0x139996(0x11c))/0x1+parseInt(_0x139996(0xe4))/0x2*(parseInt(_0x139996(0x115))/0x3)+parseInt(_0x139996(0x123))/0x4+parseInt(_0x139996(0x12e))/0x5+parseInt(_0x139996(0x116))/0x6+parseInt(_0x139996(0x127))/0x7+parseInt(_0x139996(0xfa))/0x8*(-parseInt(_0x139996(0xd7))/0x9);if(_0x20d772===_0x1f1f6a)break;else _0x471478['push'](_0x471478['shift']());}catch(_0x3b96ac){_0x471478['push'](_0x471478['shift']());}}}(_0x5de8,0x30d5f));import{createClient}from'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';const SUPABASE_URL=_0xc36330(0x125),MOZI=_0xc36330(0x105),db=createClient(SUPABASE_URL,MOZI);function escapeHTML(_0x3cd2f1){const _0x1a51ff=_0xc36330;return _0x3cd2f1[_0x1a51ff(0x11d)](/[&<>"']/g,_0x37611a=>({'&':'&amp;','<':_0x1a51ff(0xcd),'>':_0x1a51ff(0xe9),'\x22':_0x1a51ff(0x122),'\x27':'&#39;'}[_0x37611a]));}function parseDecorations(_0x1b9ea0){const _0x1f3af7=_0xc36330;return _0x1b9ea0=_0x1b9ea0[_0x1f3af7(0x11d)](/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(_0x35a224,_0x2b2c10,_0x156ee4)=>'<a\x20href=\x22'+_0x156ee4+_0x1f3af7(0x102)+escapeHTML(_0x2b2c10)+_0x1f3af7(0xf6)),_0x1b9ea0=_0x1b9ea0[_0x1f3af7(0x11d)](/(https?:\/\/[^\s<>"']+)/g,_0x70cd51=>'<a\x20href=\x22'+_0x70cd51+_0x1f3af7(0x102)+escapeHTML(_0x70cd51)+'</a>'),_0x1b9ea0;}function generateDailyId(){const _0xf15800=_0xc36330,_0x3e000c=new Date()[_0xf15800(0x12d)]()[_0xf15800(0x133)](0x0,0xa),_0x25735d=localStorage[_0xf15800(0xcf)](_0xf15800(0x108)),_0x1fc597=localStorage[_0xf15800(0xcf)](_0xf15800(0x107));if(_0x25735d&&_0x1fc597===_0x3e000c)return _0x25735d;const _0x306172=_0xf15800(0x10e);let _0x5310ca='';for(let _0x408d29=0x0;_0x408d29<0x4;_0x408d29++)_0x5310ca+=_0x306172[_0xf15800(0x118)](Math[_0xf15800(0xe3)](Math[_0xf15800(0x114)]()*_0x306172[_0xf15800(0x106)]));return localStorage[_0xf15800(0xec)](_0xf15800(0x108),_0x5310ca),localStorage[_0xf15800(0xec)](_0xf15800(0x107),_0x3e000c),_0x5310ca;}const listView=document[_0xc36330(0x10d)]('list-view'),threadBox=document['getElementById'](_0xc36330(0xd3)),postsEl=document[_0xc36330(0x10d)](_0xc36330(0xe5)),viewWrap=document[_0xc36330(0x10d)](_0xc36330(0xf9)),viewTitle=document[_0xc36330(0x10d)](_0xc36330(0xfb)),newTitle=document['getElementById'](_0xc36330(0xce)),newBody=document[_0xc36330(0x10d)](_0xc36330(0x12f)),btnCreate=document[_0xc36330(0x10d)]('create-thread'),inputMsg=document['getElementById'](_0xc36330(0xde)),btnSend=document[_0xc36330(0x10d)](_0xc36330(0xe7)),btnBack=document[_0xc36330(0x10d)](_0xc36330(0x126)),btnBackTop=document[_0xc36330(0x10d)](_0xc36330(0xef)),btnRefreshThreads=document[_0xc36330(0x10d)](_0xc36330(0xe1)),btnRefreshPosts=document['getElementById'](_0xc36330(0x124));let currentThreadId=null,lastPostTime=0x0;function fmt(_0x1e6b34){const _0x20dfe6=_0xc36330;if(!_0x1e6b34)return'';const _0x52022f=_0x1e6b34 instanceof Date?_0x1e6b34:new Date(_0x1e6b34);if(isNaN(_0x52022f))return'';const _0xdad98e=['日','月','火','水','木','金','土'][_0x52022f[_0x20dfe6(0x11e)]()],_0x55272b=(_0x4b00b3,_0x1f1be2=0x2)=>String(_0x4b00b3)[_0x20dfe6(0xd6)](_0x1f1be2,'0');return _0x52022f[_0x20dfe6(0x12b)]()+'/'+_0x55272b(_0x52022f[_0x20dfe6(0xdd)]()+0x1)+'/'+_0x55272b(_0x52022f[_0x20dfe6(0xf1)]())+'('+_0xdad98e+')\x20'+_0x55272b(_0x52022f[_0x20dfe6(0xe2)]())+':'+_0x55272b(_0x52022f[_0x20dfe6(0x12a)]())+':'+_0x55272b(_0x52022f[_0x20dfe6(0x138)]());}async function loadThreads(){const _0x288c09=_0xc36330,{data:_0x4efd0c,error:_0xc31cf}=await db[_0x288c09(0xed)](_0x288c09(0x129))[_0x288c09(0x136)](_0x288c09(0xd0));if(_0xc31cf){console[_0x288c09(0x11b)](_0xc31cf);return;}_0x4efd0c['sort']((_0x12f391,_0x2c768c)=>{const _0x11fbb5=_0x288c09,_0x9105a1=_0x12f391[_0x11fbb5(0xe5)]['length']>0x0?new Date(_0x12f391[_0x11fbb5(0xe5)][_0x12f391[_0x11fbb5(0xe5)][_0x11fbb5(0x106)]-0x1][_0x11fbb5(0xd8)]):new Date(_0x12f391[_0x11fbb5(0xd8)]),_0x2e2566=_0x2c768c['posts'][_0x11fbb5(0x106)]>0x0?new Date(_0x2c768c[_0x11fbb5(0xe5)][_0x2c768c[_0x11fbb5(0xe5)][_0x11fbb5(0x106)]-0x1][_0x11fbb5(0xd8)]):new Date(_0x2c768c['created_at']);return _0x2e2566-_0x9105a1;}),threadBox[_0x288c09(0xf3)]='';for(const _0x3d0245 of _0x4efd0c){const _0xa71658=document[_0x288c09(0x137)]('div');_0xa71658[_0x288c09(0x128)][_0x288c09(0x11a)]=_0x288c09(0x10a),_0xa71658[_0x288c09(0x128)]['margin']=_0x288c09(0xee),_0xa71658[_0x288c09(0x128)][_0x288c09(0x10f)]=_0x288c09(0xd2);const _0x391607=document[_0x288c09(0x137)]('a');_0x391607[_0x288c09(0xcc)]='?thread='+_0x3d0245['id'],_0x391607[_0x288c09(0xf3)]=escapeHTML(_0x3d0245['title'])+'\x20('+_0x3d0245[_0x288c09(0xe5)][_0x288c09(0x106)]+')',_0x391607[_0x288c09(0x131)](_0x288c09(0xf2),_0x29a70c=>{const _0x35ad9f=_0x288c09;_0x29a70c[_0x35ad9f(0xf5)](),openThread(Number(_0x3d0245['id']),_0x3d0245[_0x35ad9f(0x10b)]);}),_0xa71658['appendChild'](_0x391607);if(_0x3d0245[_0x288c09(0xe5)]&&_0x3d0245[_0x288c09(0xe5)][_0x288c09(0x106)]>0x0){const _0xce8803=_0x3d0245[_0x288c09(0xe5)][_0x288c09(0xdb)]((_0x5e473d,_0x3cf98d)=>new Date(_0x5e473d[_0x288c09(0xd8)])-new Date(_0x3cf98d['created_at']))[0x0],_0x213a6a=document['createElement'](_0x288c09(0xf7));_0x213a6a[_0x288c09(0xd9)]='thread-first';let _0x455909=_0xce8803[_0x288c09(0x134)][_0x288c09(0x11d)](/^\[[A-Z0-9]{4}\]\s*/,'');_0x455909=parseDecorations(_0x455909),_0x213a6a[_0x288c09(0xf3)]=_0x455909,_0xa71658[_0x288c09(0x10c)](_0x213a6a);}threadBox[_0x288c09(0x10c)](_0xa71658);}listView[_0x288c09(0x128)][_0x288c09(0x110)]=_0x288c09(0x101);}btnCreate[_0xc36330(0x131)](_0xc36330(0xf2),async()=>{const _0xa1465d=_0xc36330,_0x3a63ba=newTitle[_0xa1465d(0x111)]['trim'](),_0x2976ae=newBody[_0xa1465d(0x111)][_0xa1465d(0x11f)]();if(!_0x3a63ba){alert('タイトルを入れて');return;}if(!_0x2976ae){alert(_0xa1465d(0xe8));return;}const {data:_0x25dcdf,error:_0x468441}=await db[_0xa1465d(0xed)](_0xa1465d(0x129))['insert']([{'title':_0x3a63ba}])['select']()[_0xa1465d(0x113)](0x1)[_0xa1465d(0xdc)]();if(_0x468441){console[_0xa1465d(0x11b)](_0x468441),alert(_0xa1465d(0xfd));return;}const _0x57aabe=Number(_0x25dcdf['id']),_0x30b7a2=generateDailyId(),{error:_0x4f6f8a}=await db[_0xa1465d(0xed)]('posts')['insert']([{'thread_id':_0x57aabe,'content':'['+_0x30b7a2+']\x20'+_0x2976ae}]);if(_0x4f6f8a){console['error'](_0x4f6f8a),alert(_0xa1465d(0xfc));return;}newTitle[_0xa1465d(0x111)]='',newBody[_0xa1465d(0x111)]='',await loadThreads(),openThread(_0x57aabe,_0x3a63ba);});async function openThread(_0x107e20,_0x4ae214){const _0x1c2ca5=_0xc36330;currentThreadId=_0x107e20,viewTitle[_0x1c2ca5(0xf8)]=_0x4ae214,history[_0x1c2ca5(0x109)](null,null,_0x1c2ca5(0xff)+_0x107e20),listView[_0x1c2ca5(0x128)][_0x1c2ca5(0x110)]='none',viewWrap[_0x1c2ca5(0x128)][_0x1c2ca5(0x110)]=_0x1c2ca5(0x101),await loadPosts();}async function loadPosts(){const _0x1cc225=_0xc36330;if(!currentThreadId)return;const {data:_0x123380,error:_0x9acf0}=await db[_0x1cc225(0xed)]('posts')[_0x1cc225(0x136)]('*')['eq']('thread_id',currentThreadId)['order'](_0x1cc225(0xd8),{'ascending':!![]});if(_0x9acf0){console[_0x1cc225(0x11b)](_0x9acf0);return;}postsEl[_0x1cc225(0xf3)]='',(_0x123380||[])['forEach']((_0x237416,_0x162bcb)=>{const _0x564504=_0x1cc225,_0x15473e=document[_0x564504(0x137)](_0x564504(0xf7));_0x15473e[_0x564504(0xd9)]=_0x564504(0xfe);const _0x4aeec8=_0x237416['content']['match'](/^\[([A-Z0-9]{4})\]\s*/),_0x6d1039=_0x4aeec8?_0x4aeec8[0x1]:_0x564504(0xda),_0x6e1e7e=_0x4aeec8?_0x237416[_0x564504(0x134)][_0x564504(0x11d)](/^\[[A-Z0-9]{4}\]\s*/,''):_0x237416[_0x564504(0x134)],_0x2e83d9=document['createElement'](_0x564504(0xf7)),_0x2c3836=document[_0x564504(0x137)](_0x564504(0x103));_0x2c3836[_0x564504(0x128)][_0x564504(0xdf)]=_0x564504(0x121),_0x2c3836[_0x564504(0xf8)]=_0x564504(0x132),_0x2e83d9['appendChild'](document[_0x564504(0x120)]('['+(_0x162bcb+0x1)+']：')),_0x2e83d9[_0x564504(0x10c)](_0x2c3836),_0x2e83d9[_0x564504(0x10c)](document[_0x564504(0x120)]('：'+fmt(_0x237416['created_at'])+_0x564504(0x135)+_0x6d1039));const _0x51d025=document['createElement'](_0x564504(0xf7));_0x51d025[_0x564504(0xf3)]=parseDecorations(_0x6e1e7e)[_0x564504(0x11d)](/\n/g,'<br>'),_0x51d025['style'][_0x564504(0xf4)]='1em',_0x15473e[_0x564504(0x10c)](_0x2e83d9),_0x15473e[_0x564504(0x10c)](_0x51d025),postsEl[_0x564504(0x10c)](_0x15473e);});}function _0x79d9(_0x19f31d,_0x566c1f){const _0x5de8c1=_0x5de8();return _0x79d9=function(_0x79d9f1,_0x480694){_0x79d9f1=_0x79d9f1-0xcc;let _0x46c07d=_0x5de8c1[_0x79d9f1];return _0x46c07d;},_0x79d9(_0x19f31d,_0x566c1f);}function _0x5de8(){const _0xab5f38=['254wjFmeE','posts','id,title','send','本文を入れて','&gt;','channel','location','setItem','from','2px\x200','back-top','new','getDate','click','innerHTML','marginLeft','preventDefault','</a>','div','textContent','thread-view','8SlXUmI','thread-title','初回本文投稿失敗','スレ作成失敗','post','?thread=','postgres_changes','block','\x22\x20target=\x22_blank\x22\x20rel=\x22noopener\x20noreferrer\x22>','span','get','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3amRxcmJlYWh1eGtpZ291ZGZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDkwMjYsImV4cCI6MjA3MTE4NTAyNn0.-5h-SQ5Vns7cNBZTaVTw14xGf-00IHnhjXTluZiUU-U','length','bbsUserIdDate','bbsUserId','replaceState','1px\x20solid\x20#000','title','appendChild','getElementById','ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789','padding','display','value','has','limit','random','2370PgVPIP','1022736sBnnzM','subscribe','charAt','投稿失敗','border','error','142179VHMjgn','replace','getDay','trim','createTextNode','green','&quot;','203404ErjAJm','refresh-posts','https://hwjdqrbeahuxkigoudfy.supabase.co','back','1212757lmmSSq','style','threads','getMinutes','getFullYear','thread','toISOString','1441755PDlLSv','thread-body-input','search','addEventListener','名無し','slice','content','\x20ID:','select','createElement','getSeconds','href','&lt;','thread-title-input','getItem','id,title,created_at,posts(*)','now','4px','thread-box','public','thread_id','padStart','3969261CCeTbv','created_at','className','----','sort','maybeSingle','getMonth','post-message','color','https://ngsesjdun.github.io/my-bbs','refresh-threads','getHours','floor'];_0x5de8=function(){return _0xab5f38;};return _0x5de8();}btnSend[_0xc36330(0x131)](_0xc36330(0xf2),async()=>{const _0x3b62b5=_0xc36330,_0x27984e=Date[_0x3b62b5(0xd1)]();if(_0x27984e-lastPostTime<0x7d0){alert('連投は2秒空けてください');return;}if(!currentThreadId)return;let _0x3b220f=inputMsg[_0x3b62b5(0x111)][_0x3b62b5(0x11f)]();if(!_0x3b220f)return;if(_0x3b220f[_0x3b62b5(0x106)]>0xc8){alert('本文は200文字までです');return;}const _0x50d790=generateDailyId(),{error:_0xb03f91}=await db[_0x3b62b5(0xed)]('posts')['insert']([{'thread_id':currentThreadId,'content':'['+_0x50d790+']\x20'+_0x3b220f}]);if(_0xb03f91){console[_0x3b62b5(0x11b)](_0xb03f91),alert(_0x3b62b5(0x119));return;}inputMsg[_0x3b62b5(0x111)]='',lastPostTime=_0x27984e,await loadPosts();}),btnBack[_0xc36330(0x131)](_0xc36330(0xf2),()=>{const _0x545d11=_0xc36330;window[_0x545d11(0xeb)][_0x545d11(0xcc)]=_0x545d11(0xe0);}),btnBackTop[_0xc36330(0x131)](_0xc36330(0xf2),()=>{const _0x13fc2c=_0xc36330;window[_0x13fc2c(0xeb)][_0x13fc2c(0xcc)]=_0x13fc2c(0xe0);}),btnRefreshThreads[_0xc36330(0x131)](_0xc36330(0xf2),async()=>{await loadThreads();}),btnRefreshPosts[_0xc36330(0x131)](_0xc36330(0xf2),async()=>{if(currentThreadId)await loadPosts();}),db[_0xc36330(0xea)]('public:posts')['on'](_0xc36330(0x100),{'event':'*','schema':_0xc36330(0xd4),'table':_0xc36330(0xe5)},_0x366ed3=>{const _0x1a0c1a=_0xc36330;if(currentThreadId&&_0x366ed3[_0x1a0c1a(0xf0)][_0x1a0c1a(0xd5)]===Number(currentThreadId))loadPosts();loadThreads();})[_0xc36330(0x117)](),loadThreads();const params=new URLSearchParams(location[_0xc36330(0x130)]);if(params[_0xc36330(0x112)]('thread')){const id=Number(params[_0xc36330(0x104)](_0xc36330(0x12c)));((async()=>{const _0x54c67a=_0xc36330,{data:_0x257369,error:_0x517d23}=await db[_0x54c67a(0xed)]('threads')[_0x54c67a(0x136)](_0x54c67a(0xe6))['eq']('id',id)[_0x54c67a(0xdc)]();if(_0x257369)openThread(Number(_0x257369['id']),_0x257369[_0x54c67a(0x10b)]);})());}
