const _0x54d3c7=_0x874f;(function(_0x5bef53,_0x4dc511){const _0xde64f4=_0x874f,_0x37083d=_0x5bef53();while(!![]){try{const _0x44c42c=-parseInt(_0xde64f4(0x1e5))/0x1*(-parseInt(_0xde64f4(0x1c0))/0x2)+parseInt(_0xde64f4(0x1e8))/0x3+parseInt(_0xde64f4(0x1f6))/0x4+-parseInt(_0xde64f4(0x1b9))/0x5+-parseInt(_0xde64f4(0x1a3))/0x6+parseInt(_0xde64f4(0x1ae))/0x7+-parseInt(_0xde64f4(0x1da))/0x8*(parseInt(_0xde64f4(0x1de))/0x9);if(_0x44c42c===_0x4dc511)break;else _0x37083d['push'](_0x37083d['shift']());}catch(_0x114759){_0x37083d['push'](_0x37083d['shift']());}}}(_0x5804,0x79e85));import{createClient}from'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';const SUPABASE_URL='https://hwjdqrbeahuxkigoudfy.supabase.co',MOZI='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3amRxcmJlYWh1eGtpZ291ZGZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDkwMjYsImV4cCI6MjA3MTE4NTAyNn0.-5h-SQ5Vns7cNBZTaVTw14xGf-00IHnhjXTluZiUU-U',db=createClient(SUPABASE_URL,MOZI);function escapeHTML(_0x456569){const _0x38a3a0=_0x874f;return _0x456569['replace'](/[&<>'"]/g,_0x7fff09=>({'&':_0x38a3a0(0x1c9),'<':_0x38a3a0(0x1a5),'>':_0x38a3a0(0x1d4),'\x27':_0x38a3a0(0x1ca),'\x22':_0x38a3a0(0x1ea)}[_0x7fff09]));}function fmt(_0x2f0839){const _0x28fbdf=_0x874f;if(!_0x2f0839)return'';const _0x56aff4=new Date(_0x2f0839);if(isNaN(_0x56aff4))return'';const _0x21a02e=['日','月','火','水','木','金','土'][_0x56aff4[_0x28fbdf(0x19c)]()],_0x26ea08=(_0x423a3f,_0x304bf3=0x2)=>String(_0x423a3f)['padStart'](_0x304bf3,'0');return _0x56aff4['getFullYear']()+'/'+_0x26ea08(_0x56aff4[_0x28fbdf(0x1b4)]()+0x1)+'/'+_0x26ea08(_0x56aff4['getDate']())+'('+_0x21a02e+')\x20'+_0x26ea08(_0x56aff4[_0x28fbdf(0x1af)]())+':'+_0x26ea08(_0x56aff4[_0x28fbdf(0x1c2)]())+':'+_0x26ea08(_0x56aff4[_0x28fbdf(0x1fb)]());}function generateDailyId(){const _0x3ea466=_0x874f,_0x1b795d=new Date()[_0x3ea466(0x1b0)]()[_0x3ea466(0x1bd)](0x0,0xa),_0x425d70=localStorage[_0x3ea466(0x1ce)](_0x3ea466(0x1ad)),_0xe237d7=localStorage['getItem'](_0x3ea466(0x1c5));if(_0x425d70&&_0xe237d7===_0x1b795d)return _0x425d70;const _0x11ca16='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';let _0x65dc8b='';for(let _0x145f17=0x0;_0x145f17<0x4;_0x145f17++)_0x65dc8b+=_0x11ca16['charAt'](Math['floor'](Math['random']()*_0x11ca16[_0x3ea466(0x1a0)]));return localStorage[_0x3ea466(0x202)]('bbsUserId',_0x65dc8b),localStorage['setItem']('bbsUserIdDate',_0x1b795d),_0x65dc8b;}async function generateTripKey(_0x450670){const _0x350666=_0x874f,_0x485c88=new TextEncoder()['encode'](_0x450670),_0x55765c=await crypto[_0x350666(0x1ab)]['digest']('SHA-256',_0x485c88),_0x97198b=Array[_0x350666(0x1b2)](new Uint8Array(_0x55765c)),_0x49fe38=btoa(String[_0x350666(0x1cb)][_0x350666(0x1f8)](null,_0x97198b));return _0x49fe38[_0x350666(0x1ee)](/[^A-Za-z0-9]/g,'')['slice'](0x0,0xa);}async function parseName(_0x321c1c){const _0x3131bb=_0x874f,_0x5a83d7=(_0x321c1c||'')[_0x3131bb(0x205)]();if(!_0x5a83d7)return _0x3131bb(0x1d0);if(_0x5a83d7[_0x3131bb(0x1e0)]('#')){const [_0x2d4cc1,_0x86cf30]=_0x5a83d7[_0x3131bb(0x1ed)]('#'),_0x27ec00=(_0x2d4cc1||'名無し')[_0x3131bb(0x205)]();if(_0x86cf30){const _0xd39597=await generateTripKey(_0x86cf30);return _0x27ec00+'◆'+_0xd39597;}return _0x27ec00;}if(_0x5a83d7[_0x3131bb(0x1e0)]('◆'))return _0x5a83d7['split']('◆')[0x0]||_0x3131bb(0x1d0);return _0x5a83d7;}const listView=document[_0x54d3c7(0x200)](_0x54d3c7(0x201)),threadBox=document[_0x54d3c7(0x200)](_0x54d3c7(0x1bf)),postsEl=document['getElementById']('posts'),viewWrap=document['getElementById']('thread-view'),viewTitle=document['getElementById']('thread-title'),newTitle=document[_0x54d3c7(0x200)](_0x54d3c7(0x1b3)),newBody=document['getElementById']('thread-body-input'),newName=document[_0x54d3c7(0x200)](_0x54d3c7(0x1a1)),btnCreate=document['getElementById'](_0x54d3c7(0x1f3)),inputMsg=document[_0x54d3c7(0x200)](_0x54d3c7(0x1e2)),inputName=document[_0x54d3c7(0x200)]('post-name'),btnSend=document[_0x54d3c7(0x200)](_0x54d3c7(0x1d6)),btnBack=document[_0x54d3c7(0x200)]('back'),btnBackTop=document['getElementById'](_0x54d3c7(0x1a4)),btnRefreshThreads=document[_0x54d3c7(0x200)](_0x54d3c7(0x1d9)),btnRefreshPosts=document['getElementById']('refresh-posts');let currentThreadId=null,lastPostTime=0x0,threadHistory=JSON['parse'](localStorage[_0x54d3c7(0x1ce)](_0x54d3c7(0x1ec))||'[]');function _0x874f(_0x23aed6,_0x4fda05){const _0x58044c=_0x5804();return _0x874f=function(_0x874fe0,_0x31de26){_0x874fe0=_0x874fe0-0x19a;let _0x36d800=_0x58044c[_0x874fe0];return _0x36d800;},_0x874f(_0x23aed6,_0x4fda05);}function _0x5804(){const _0x5ee9d8=['push','has','dataset','display','getElementById','list-view','setItem','location','posts','trim','addEventListener','target','search','getDay','preventDefault','get','createTextNode','length','thread-name-input','thread-first','2353608lhlcaz','back-top','&lt;','focus','id,title','threads','#res-','初回本文投稿失敗','subtle','textContent','bbsUserId','3188906aikLNf','getHours','toISOString','now','from','thread-title-input','getMonth','border','classList','order','タイトルと本文を入力','2403310YSmIel','post-body','contains','5分以内にスレッドは8回しか作れません','slice','href','thread-box','382454aDQVXy','block','getMinutes','\x20ID:','2px\x200','bbsUserIdDate','insert','----','className','&amp;','&#39;','fromCharCode','title','limit','getItem','click','名無し','投稿失敗','res-link','style','&gt;','value','send','post-header','?thread=','refresh-threads','1168408iNZJUD','match','スレ作成失敗','連投は3秒空けてください','27VLclQf','maybeSingle','includes','div','post-message','thread','filter','2SBKvBJ','createElement','res','744531VaLaTi','created_at','&quot;','innerHTML','threadHistory','split','replace','appendChild','span','select','content','create-thread','1px\x20solid\x20#000','error','2896908YKbbrQ','pathname','apply','name-nanashi','sort','getSeconds'];_0x5804=function(){return _0x5ee9d8;};return _0x5804();}const PREFIX_RE=/^\[([A-Z0-9]{4})\](?:\[([^\]]+)\])?\s*/;async function loadThreads(){const _0x5134bc=_0x54d3c7,{data:_0x4a167d,error:_0x24e061}=await db['from'](_0x5134bc(0x1a8))['select']('id,title,created_at,posts(*)');if(_0x24e061){console['error'](_0x24e061);return;}_0x4a167d['sort']((_0x2deebd,_0x265e4e)=>{const _0x10d971=_0x5134bc,_0x2cb7b4=_0x2deebd[_0x10d971(0x204)][_0x10d971(0x1a0)]>0x0?new Date(_0x2deebd['posts'][_0x2deebd[_0x10d971(0x204)][_0x10d971(0x1a0)]-0x1]['created_at']):new Date(_0x2deebd['created_at']),_0x43ef3f=_0x265e4e[_0x10d971(0x204)][_0x10d971(0x1a0)]>0x0?new Date(_0x265e4e[_0x10d971(0x204)][_0x265e4e[_0x10d971(0x204)][_0x10d971(0x1a0)]-0x1][_0x10d971(0x1e9)]):new Date(_0x265e4e[_0x10d971(0x1e9)]);return _0x43ef3f-_0x2cb7b4;}),threadBox[_0x5134bc(0x1eb)]='';for(const _0x5f5442 of _0x4a167d){const _0x53ae4d=document[_0x5134bc(0x1e6)](_0x5134bc(0x1e1));_0x53ae4d[_0x5134bc(0x1d3)][_0x5134bc(0x1b5)]=_0x5134bc(0x1f4),_0x53ae4d[_0x5134bc(0x1d3)]['margin']=_0x5134bc(0x1c4),_0x53ae4d[_0x5134bc(0x1d3)]['padding']='4px';const _0x263c9e=document[_0x5134bc(0x1e6)]('a');_0x263c9e[_0x5134bc(0x1be)]=_0x5134bc(0x1d8)+_0x5f5442['id'],_0x263c9e['innerHTML']=escapeHTML(_0x5f5442[_0x5134bc(0x1cc)])+'\x20('+_0x5f5442[_0x5134bc(0x204)]['length']+')',_0x263c9e['addEventListener']('click',_0x509dcb=>{const _0x509941=_0x5134bc;_0x509dcb[_0x509941(0x19d)](),openThread(Number(_0x5f5442['id']),_0x5f5442[_0x509941(0x1cc)]);}),_0x53ae4d[_0x5134bc(0x1ef)](_0x263c9e);if(_0x5f5442[_0x5134bc(0x204)]&&_0x5f5442[_0x5134bc(0x204)][_0x5134bc(0x1a0)]>0x0){const _0x57ea0c=_0x5f5442[_0x5134bc(0x204)][_0x5134bc(0x1bd)]()[_0x5134bc(0x1fa)]((_0x30109a,_0x421ac5)=>new Date(_0x30109a[_0x5134bc(0x1e9)])-new Date(_0x421ac5[_0x5134bc(0x1e9)]))[0x0],_0x373ff1=document[_0x5134bc(0x1e6)](_0x5134bc(0x1e1));_0x373ff1[_0x5134bc(0x1c8)]=_0x5134bc(0x1a2),_0x373ff1[_0x5134bc(0x1ac)]=(_0x57ea0c['content']||'')[_0x5134bc(0x1ee)](PREFIX_RE,''),_0x53ae4d[_0x5134bc(0x1ef)](_0x373ff1);}threadBox['appendChild'](_0x53ae4d);}listView[_0x5134bc(0x1d3)]['display']=_0x5134bc(0x1c1);}btnCreate[_0x54d3c7(0x206)](_0x54d3c7(0x1cf),async()=>{const _0xc27d40=_0x54d3c7,_0x8d30dd=Date['now']();threadHistory=threadHistory[_0xc27d40(0x1e4)](_0x16ef4b=>_0x8d30dd-_0x16ef4b<0x5*0x3c*0x3e8);if(threadHistory[_0xc27d40(0x1a0)]>=0x8){alert(_0xc27d40(0x1bc));return;}const _0x1f87ad=newTitle[_0xc27d40(0x1d5)]['trim'](),_0x114ddc=newBody[_0xc27d40(0x1d5)][_0xc27d40(0x205)](),_0x32eb78=newName[_0xc27d40(0x1d5)]['trim']();if(!_0x1f87ad||!_0x114ddc){alert(_0xc27d40(0x1b8));return;}const _0x3c3ae4=await parseName(_0x32eb78),{data:_0x578842,error:_0xad2f2d}=await db[_0xc27d40(0x1b2)](_0xc27d40(0x1a8))[_0xc27d40(0x1c6)]([{'title':_0x1f87ad}])[_0xc27d40(0x1f1)]()[_0xc27d40(0x1cd)](0x1)[_0xc27d40(0x1df)]();if(_0xad2f2d){console['error'](_0xad2f2d),alert(_0xc27d40(0x1dc));return;}const _0x5a47d6=Number(_0x578842['id']),_0x47c13d=generateDailyId(),_0x4064f5='['+_0x47c13d+']['+_0x3c3ae4+']\x20'+_0x114ddc,{error:_0x140bb0}=await db['from'](_0xc27d40(0x204))[_0xc27d40(0x1c6)]([{'thread_id':_0x5a47d6,'content':_0x4064f5}]);if(_0x140bb0){console[_0xc27d40(0x1f5)](_0x140bb0),alert(_0xc27d40(0x1aa));return;}threadHistory[_0xc27d40(0x1fc)](_0x8d30dd),localStorage[_0xc27d40(0x202)](_0xc27d40(0x1ec),JSON['stringify'](threadHistory)),newTitle[_0xc27d40(0x1d5)]='',newBody[_0xc27d40(0x1d5)]='',newName[_0xc27d40(0x1d5)]='',await loadThreads(),openThread(_0x5a47d6,_0x1f87ad);});async function openThread(_0x597435,_0x20eade){const _0x2cc04e=_0x54d3c7;currentThreadId=_0x597435,viewTitle['textContent']=_0x20eade,history['replaceState'](null,null,_0x2cc04e(0x1d8)+_0x597435),listView[_0x2cc04e(0x1d3)][_0x2cc04e(0x1ff)]='none',viewWrap[_0x2cc04e(0x1d3)][_0x2cc04e(0x1ff)]=_0x2cc04e(0x1c1),await loadPosts();}async function loadPosts(){const _0x530503=_0x54d3c7;if(!currentThreadId)return;const {data:_0x22adb2,error:_0x575f83}=await db['from'](_0x530503(0x204))[_0x530503(0x1f1)]('*')['eq']('thread_id',currentThreadId)[_0x530503(0x1b7)]('created_at',{'ascending':!![]});if(_0x575f83){console[_0x530503(0x1f5)](_0x575f83);return;}postsEl[_0x530503(0x1eb)]='',(_0x22adb2||[])['forEach']((_0x3da95b,_0x5f1be7)=>{const _0x554b68=_0x530503,_0x6df2dd=document[_0x554b68(0x1e6)](_0x554b68(0x1e1));_0x6df2dd[_0x554b68(0x1c8)]='post';let _0x4e471b=_0x554b68(0x1d0),_0x54b451=_0x554b68(0x1c7);const _0xe18e09=(_0x3da95b[_0x554b68(0x1f2)]||'')[_0x554b68(0x1db)](PREFIX_RE);_0xe18e09&&(_0x54b451=_0xe18e09[0x1]||_0x54b451,_0x4e471b=_0xe18e09[0x2]&&_0xe18e09[0x2]['trim']()?_0xe18e09[0x2][_0x554b68(0x205)]():_0x554b68(0x1d0));const _0x21000e=(_0x3da95b['content']||'')[_0x554b68(0x1ee)](PREFIX_RE,''),_0x49bed8=document[_0x554b68(0x1e6)]('div');_0x49bed8[_0x554b68(0x1c8)]=_0x554b68(0x1ba),_0x49bed8['textContent']=_0x21000e;const _0x228e06=document[_0x554b68(0x1e6)](_0x554b68(0x1e1));_0x228e06[_0x554b68(0x1c8)]=_0x554b68(0x1d7);const _0x38ecba=document['createElement']('a');_0x38ecba[_0x554b68(0x1be)]=_0x554b68(0x1a9)+(_0x5f1be7+0x1),_0x38ecba[_0x554b68(0x1fe)][_0x554b68(0x1e7)]=_0x5f1be7+0x1,_0x38ecba[_0x554b68(0x1c8)]=_0x554b68(0x1d2),_0x38ecba[_0x554b68(0x1ac)]='['+(_0x5f1be7+0x1)+']';const _0x18933a=document[_0x554b68(0x1e6)](_0x554b68(0x1f0));_0x18933a[_0x554b68(0x1ac)]=_0x4e471b;if(_0x4e471b===_0x554b68(0x1d0))_0x18933a['className']=_0x554b68(0x1f9);_0x228e06[_0x554b68(0x1ef)](_0x38ecba),_0x228e06[_0x554b68(0x1ef)](document[_0x554b68(0x19f)]('：')),_0x228e06['appendChild'](_0x18933a),_0x228e06['appendChild'](document[_0x554b68(0x19f)]('：'+fmt(_0x3da95b[_0x554b68(0x1e9)])+_0x554b68(0x1c3)+_0x54b451)),_0x6df2dd[_0x554b68(0x1ef)](_0x228e06),_0x6df2dd['appendChild'](_0x49bed8),postsEl[_0x554b68(0x1ef)](_0x6df2dd);});}btnSend['addEventListener']('click',async()=>{const _0x1f23c7=_0x54d3c7,_0x3ef56d=Date[_0x1f23c7(0x1b1)]();if(_0x3ef56d-lastPostTime<0xbb8){alert(_0x1f23c7(0x1dd));return;}if(!currentThreadId)return;let _0x1fb81a=inputMsg[_0x1f23c7(0x1d5)][_0x1f23c7(0x205)]();if(!_0x1fb81a)return;if(_0x1fb81a[_0x1f23c7(0x1a0)]>0xc8){alert('本文は200文字までです');return;}const _0x1d1ae0=await parseName(inputName[_0x1f23c7(0x1d5)]['trim']()),_0x5b0a48=generateDailyId(),_0x3e9782='['+_0x5b0a48+']['+_0x1d1ae0+']\x20'+_0x1fb81a,{error:_0x2a2f2c}=await db['from'](_0x1f23c7(0x204))[_0x1f23c7(0x1c6)]([{'thread_id':currentThreadId,'content':_0x3e9782}]);if(_0x2a2f2c){console[_0x1f23c7(0x1f5)](_0x2a2f2c),alert(_0x1f23c7(0x1d1));return;}inputMsg[_0x1f23c7(0x1d5)]='',inputName['value']='',lastPostTime=_0x3ef56d,await loadPosts();}),btnBack[_0x54d3c7(0x206)](_0x54d3c7(0x1cf),()=>{const _0x54a57b=_0x54d3c7;window[_0x54a57b(0x203)]['href']=window[_0x54a57b(0x203)]['pathname'];}),btnBackTop[_0x54d3c7(0x206)]('click',()=>{const _0x19e021=_0x54d3c7;window[_0x19e021(0x203)][_0x19e021(0x1be)]=window[_0x19e021(0x203)][_0x19e021(0x1f7)];}),btnRefreshThreads[_0x54d3c7(0x206)](_0x54d3c7(0x1cf),async()=>{await loadThreads();}),btnRefreshPosts['addEventListener'](_0x54d3c7(0x1cf),async()=>{if(currentThreadId)await loadPosts();}),document[_0x54d3c7(0x206)](_0x54d3c7(0x1cf),_0x54a8aa=>{const _0x5493f3=_0x54d3c7;if(_0x54a8aa[_0x5493f3(0x19a)][_0x5493f3(0x1b6)][_0x5493f3(0x1bb)]('res-link')){_0x54a8aa[_0x5493f3(0x19d)]();const _0x54a0c9=_0x54a8aa[_0x5493f3(0x19a)][_0x5493f3(0x1fe)][_0x5493f3(0x1e7)],_0x7685a0=document['getElementById'](_0x5493f3(0x1e2));_0x7685a0[_0x5493f3(0x1d5)]+='>>'+_0x54a0c9+'\x0a',_0x7685a0[_0x5493f3(0x1a6)]();}}),await loadThreads();const params=new URLSearchParams(location[_0x54d3c7(0x19b)]);if(params[_0x54d3c7(0x1fd)](_0x54d3c7(0x1e3))){const id=Number(params[_0x54d3c7(0x19e)](_0x54d3c7(0x1e3))),{data}=await db['from'](_0x54d3c7(0x1a8))[_0x54d3c7(0x1f1)](_0x54d3c7(0x1a7))['eq']('id',id)[_0x54d3c7(0x1df)]();if(data)openThread(Number(data['id']),data[_0x54d3c7(0x1cc)]);}
